# 第二章 从硬件到软件的层级概述



这一章将告诉你软件和硬件是如何交互的，以及如何在物理层面上表示软件。



## 2.1 一个 bit 的物理级实现



所有的电子设备，无论简单还是复杂，都是操作电流去达到预期的效果的。计算机当然不例外。我们写软件的时候，实际上，我们间接操纵了电流。只有这样，底层的机器才能发挥作用。



为了理解这个过程，我们假想一个简单的电灯泡。一个电灯泡可以有两种状态开或者关，关意味着 0 开意味着 1。



![](https://upload-images.jianshu.io/upload_images/15548795-c75443a3636baf56.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



然而，这样有个问题，**开关是人操纵的**。我们需要的是一个根据电压的自动开关。为了能够自动改变电子信号，有三个牛 b 的人（William Shockley, John Bardeen and Walter Brattain）发明了一种叫做「*晶体管（transistor）*」 的设备。**这个设备开启了整个计算机行业**。



实际上，晶体管就是电阻。电阻的值可以根据输入电压的值变化而变化。



有这样一个特性，晶体管就可以变成一个电流放大器（高电压，低阻值），根据电压的大小，也可以是一个电信号的开关（阻隔或非阻隔）。

0 v 的时候没有电流可以通过，因此它就像一个开关打开的电路（灯泡关闭）因为电阻的值足够阻隔电流。同样的是，在 3.5 V 电流可以通过晶体管，因为电阻值下降了，有效地实现电子流动，因此就像一个开关闭合的电路。





一个 bit 有两种状态：0 或者 1。与电灯泡相同，可以被关闭和打开。bit 来自电流：bit 0 用 0v（无电流）表示，bit 1用 3.5V 到 5V（有电流）表示。晶体管可以正确地实现 bit，因为它可以根据电压调节电流。



### 2.1.1 MOSFET 晶体管



被发明创造出来的晶体管打开了一个全新的微型数字设备的世界。在这之前，真空管（仅仅比灯泡好点）被用来表示 0 和 1，需要人们手动打开或者关闭。



1959 年，Dawon Kahng 和 Martin M. (John) Atalla 在贝尔实验室中发明了 MOSFET 晶体管（M etal–Oxide–Semiconductor Field-Effect MOSFET T ransistor）。这种晶体管更好更适合。



### 2.2 超越晶体管：数字逻辑门



所有数字设备都设计有逻辑门。*逻辑门（logic gate）* 是能够实现 bool 类型函数的设备。每一个逻辑门都包含输入和输出。所有的计算机都是由非常多个逻辑门组合起来的，也就是由非常多的 bool 型函数构成。

![](https://upload-images.jianshu.io/upload_images/15548795-0914b1be96585bb4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 2.2.1 逻辑门背后的原理

*逻辑门（Logic gates）*仅接受二进制和输出二进制。换句话说，逻辑门就是转换二进制值的函数。幸好存在着处理二进制数的数学理论——「布尔代数（Boolean Algebra）」



当逻辑门能够实现一些特定的布尔函数的时候，所有的布尔函数集合在功能上是完整的，只要这些特定的布尔函数能够构造其他的布尔函数。



不久，有人（Charles Sanders Peirce）就证明了 NOR 或者 NAND 就能组合其他所有的布尔函数。布尔函数的可以用逻辑门表示，也就是说，NAND 或者 NOR 的逻辑门就可以表示其他所有的逻辑门。



最简单的逻辑门 CMOS 电路可以实现一个逆变器（NOT gates）。几个逆变器在一起就能构成一个 NAND 门。有了 NAND 门我们就能创建所有的逻辑门了。这就是为什么晶体管的发明，以及 CMOS 电路彻底改变了计算机行业。



我们应该要意识到，布尔函数有多么的牛逼。



![](https://upload-images.jianshu.io/upload_images/15548795-6f4ded1a20349a64.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



### 逻辑门的实现：CMOS 电路



底层中每一个逻辑们都是一个叫做的 CMOS（Complementary CMOS MOSFET）电路。CMOS 包含两个晶体管。NMOS 和 PMOS。最简单的 CMOS 电路就是一个逆转器或者 NOT 门：



![](https://upload-images.jianshu.io/upload_images/15548795-ba206b6a07617803.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



NOT 门完成了，NAND 门也就不远了：



![](https://upload-images.jianshu.io/upload_images/15548795-4de3f5e85a50347b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)





有了 NAND 门，其他门也就有了。就如图示的那样如此简单的电路就能实现一个逻辑操作。真的是太神奇了。在我们的编程语言中，NOT 操作 就是 ~。& 就是 AND 门。代码并不是跑在神秘的魔法盒上。相反，代码的执行是非常清晰与透明的，就是在小小的硬件电路上运行。



当我们写软件的时候，我们简单地操纵物理水平的电流来运行适当的电路以产生期望的结果。然而，整个过程在某种程度上与任何涉及电流的思想无关。这是真正的黑魔法，很快就会解释.



CMOS 的一个有趣特性是 **k 个输入门使用 k 个 PMOS 和 k 个 NMOS 晶体管（Wakerly，1999）**。所有逻辑门都是由 NMOS 和 PMOS 晶体管构成的，门是所有数字设备的构建模块，从简单到复杂，包括任何计算机。这种模式使得**实际物理实现和逻辑实现**得以分开。



数字设计是通过逻辑门设计完成的，然后被“编译”成物理电路。实际上，稍后我们将看到逻辑门成为描述电路如何工作的语言。了解 CMOS 的工作原理对于了解计算机的设计方式以及计算机的工作方式非常重要。



最后，带有导线和晶体管的被封装好实际电路叫做**芯片（chip）**。芯片是刻蚀集成电路的基板。但是在消费者市场上，**芯片**也指完全封装的集成电路（就是我们平时理解的芯片）。上下文不同，芯片的意义也不同。



--------------------------

举个栗子：(ﾟд⊙)



74HC00 是一个有两输入的 NAND 门的芯片。芯片配有 8 个输入引脚和 4 个输出引脚，1 个引脚用于连接电压源，1 个引脚用于连接到地。该器件是 NAND 门的物理实现，我们可以实际使用它。但是芯片不是只有一个门，而是带有 4 个可以组合的门。每种组合都可以实现不同的逻辑功能，有效地创建其他逻辑门。这个功能使得芯片十分流行。



如前所述，上面的每个门只是一个带有电子流的简单 NAND 电路。然而，许多这些 NAND 门芯片组合在一起可以构建一个简单的计算机。物理层面的软件只是电子流。



![](https://upload-images.jianshu.io/upload_images/15548795-f7c5f41cb535dc8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



![](https://upload-images.jianshu.io/upload_images/15548795-4e437eb97fabfbfd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



![](https://upload-images.jianshu.io/upload_images/15548795-ee3971ac89567de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



如何使用 74HC00 创建上述门？真的很简单：每个门有 2 个输入引脚和 1 个引脚输出，我们可以将 1 个 NAND 门的输出写入另一个 NAND 门的输入，从而将 NAND 门连接在一起，产生如上图的门。



--------------------------





### 2.3 超越逻辑门：机器语言



因为门只接受一系列的 0 和 1，所以建立在门上的硬件设备只能理解 0 和 1。而且，设备只能以系统的方式接受 0 和 1。*「机器语言」（Machine language）* 是独一无二的 bit 代码。我们的设备可以识别他们并做出反应。在计算机系统中，有属于自己的机器语言的设备叫做 **CPU**。控制所有计算机内部的所有活动。



举个栗子：Σ(*ﾟдﾟﾉ)ﾉ



在 x86 架构中，10100000 告诉 CPU 相加两个数字，又或者 000000101 去停止计算机。在计算机时代的上古时期，程序员只能用二进制编程。



![](https://upload-images.jianshu.io/upload_images/15548795-ba59c11748d564f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



为什么这样的 bit 模式会有用？原因是每条指令都是一个实现指令的小电路。这种 bit 模式与在计算中程序通过名字调用程序的模式类似。一种 bit 模式就是 CPU 一个小功能的名字。如果 CPU 找得到，就执行。



注意：CPU 不是唯一一个有自己机器语言的设备。CPU 只是一个代号用来指示他是一个能控制计算机系统的硬件设备。一个有自己机器语言的设备就是*可编程设备（programmable device）* 。因为用户可以使用该语言命令设备执行不同的操作。例如，打印机具有一组命令，用于指示它如何填充页面。



-------------------------------------



再举个栗子：(☉д⊙)



用户可以在不知道其内部信息的情况下使用 74HC00 芯片，但只能使用该设备的接口。首先，我们需要知道它的布局：



![](https://upload-images.jianshu.io/upload_images/15548795-d1e147eedd3b0e1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



每个引脚的作用：



![](https://upload-images.jianshu.io/upload_images/15548795-1388206ddbce007d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

最后怎么使用这些引脚



![](https://upload-images.jianshu.io/upload_images/15548795-eadc1c292f2d01d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



注意：



+ n 是数字 1 2 3 4
+ H 是高电压；L 是低电压；X 是任意值



`上述表中`提供了包含所有可能的输入和输出的真值表，其中还描述了设备中所有引脚的使用。用户不需要知道实现，但是可以在这样的表上使用该设备。我们可以说上面的**真值表就是设备的机器语言**。由于该设备是数字设备，因此其语言是二进制字符串的集合



+ 该器件有 8 个输入引脚，这意味着它接受 8 位二进制字符串。

+ 该器件具有 4 个输出引脚，这意味着它可以从 8 位输入产生 4 位二进制串

